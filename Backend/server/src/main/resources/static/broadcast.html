<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>FCM 메시지 전송</title>
    <script>
        // 쿠폰 템플릿을 가져와서 select 요소에 추가하는 함수
        function loadCouponTemplates() {
            fetch('/rest/coupon/templates')
                .then(response => response.json())
                .then(data => {
                    var select = document.getElementById('couponTemplateSelect');
                    data.forEach(function(template) {
                        var option = document.createElement('option');
                        option.value = template.id;
                        option.text = template.name + ' - ' + template.description;
                        select.add(option);
                    });
                })
                .catch(error => console.error('Error:', error));
        }

        // 폼 제출 처리 함수
        function handleSubmit(event, form, endpoint) {
            event.preventDefault();
            const formData = new FormData(form);
            const data = {};
            formData.forEach((value, key) => data[key] = value);

            fetch(endpoint, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                },
                body: new URLSearchParams(data)
            })
            .then(response => response.text())
            .then(result => {
                alert(result);
                form.reset();
            })
            .catch(error => {
                alert('오류가 발생했습니다: ' + error);
            });
        }

        window.onload = function() {
            loadCouponTemplates();

            // 각 폼에 이벤트 리스너 추가
            document.querySelectorAll('form').forEach(form => {
                const endpoint = form.action;
                form.addEventListener('submit', (e) => handleSubmit(e, form, endpoint));
            });
        };
    </script>
</head>
<body>
    <h1>FCM 메시지 전송 - Notification</h1>
    <form action="/rest/fcm/sendMessage" method="post">
        <input type="text" name="token" size=100 placeholder="토큰을 입력하세요"><br>
        <input type="text" name="title" placeholder="제목을 입력하세요"><br>
        <textarea rows="5" name="body" cols="100" placeholder="내용을 입력하세요"></textarea><br>
        <input type="submit" value="전송"><input type="reset">
    </form>

    <h1>특정 사용자에게 메시지 전송</h1>
    <form action="/rest/fcm/sendMessageToUser" method="post">
        <input type="text" name="userId" placeholder="사용자 ID를 입력하세요"><br>
        <input type="text" name="title" placeholder="제목을 입력하세요"><br>
        <textarea rows="5" name="body" cols="100" placeholder="내용을 입력하세요"></textarea><br>
        <input type="submit" value="전송"><input type="reset">
    </form>

    <h1>전체 사용자에게 메시지 전송</h1>
    <form action="/rest/fcm/broadcast" method="post">
        <input type="text" name="title" placeholder="제목을 입력하세요"><br>
        <textarea rows="5" name="body" cols="100" placeholder="내용을 입력하세요"></textarea><br>
        <input type="submit" value="전송"><input type="reset">
    </form>

    <h1>특정 사용자에게 쿠폰 지급 및 알림 전송</h1>
    <form action="/rest/coupon/giveCouponWithNotification" method="post">
        <input type="text" name="userId" placeholder="사용자 ID를 입력하세요"><br>
        <label for="couponTemplateSelect">쿠폰 선택:</label>
        <select name="couponTemplateId" id="couponTemplateSelect">
        </select><br>
        <input type="text" name="title" placeholder="제목을 입력하세요"><br>
        <textarea rows="5" name="body" cols="100" placeholder="내용을 입력하세요"></textarea><br>
        <input type="submit" value="전송"><input type="reset">
    </form>
</body>
</html>